<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>CruzSafe: Intake</title>
        <!--Imports Stylesheet-->
        <link href="./stylesheets/main.css" type="text/css" rel="stylesheet" />
        <link
            href="./stylesheets/reports.css"
            type="text/css"
            rel="stylesheet"
        />
        <link
            href="./stylesheets/reportSingle.css"
            type="text/css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
        />
    </head>
    <body>
        <header>
            <div class="topnav" id="topNav">
                <a href="./homepage.html"
                    ><i class="fa fa-home" aria-hidden="true"></i> Home</a
                >
                <a class="active" href="./intake.html"
                    ><i class="fa fa-paper-plane" aria-hidden="true"></i>
                    Intake</a
                >
                <a href="./reports.html"
                    ><i class="fa fa-folder" aria-hidden="true"></i> Reports</a
                >
                <a href="./analytics.html"
                    ><i class="fa fa-pie-chart" aria-hidden="true"></i>
                    Analytics</a
                >
                <a href="./admin.html">
                    <i class="fa fa-user-circle-o" aria-hidden="true"></i>
                    Admin</a
                >
                <a href="./settings.html"
                    ><i class="fa fa-cog" aria-hidden="true"></i> Settings</a
                >
                <a href="./"
                    ><i class="fa fa-sign-out" aria-hidden="true"></i>
                    Sign-Out</a
                >
                <a class="icon" onclick="toggleTopNav()">
                    <i class="fa fa-bars" aria-hidden="true"></i>
                </a>
            </div>
        </header>
        <main class="withHeader">
            <div class="column">
                <div class="row quarter leaf filterFix">
                    <div id="filterOptions" class="filterOptions">
                        <div
                            style="display:flex; justify-content: space-between"
                        >
                            <h3>Filters:</h3>
                            <a
                                class="btn clear rounded icon"
                                onclick="toggleFilters()"
                            >
                                <i class="fa fa-bars" aria-hidden="true"></i>
                            </a>
                        </div>
                        <div class="filterInputs">
                            <input
                                id="filterReportID"
                                placeholder="Report id(s)"
                            />
                            <input
                                id="filterIncidentID"
                                placeholder="Incident id(s)"
                            />
                            <input id="filterTag" placeholder="Tag" />
                            <input
                                id="filterMobileID"
                                placeholder="Mobile user id(s)"
                            />
                            <input
                                id="filterFirstName"
                                placeholder="First name"
                            />
                            <input
                                id="filterLastName"
                                placeholder="Last name"
                            />
                            <input
                                id="filterEmail"
                                placeholder="Email (Enter xxx@ucsc.edu)"
                            />
                            <input
                                id="filterPhone"
                                placeholder="Phone (Enter 555555555)"
                            />
                            <input
                                id="filterDate"
                                placeholder="Report date (MM/DD/YYYY)"
                            />
                            <input
                                id="filterTime"
                                placeholder="Report time (HH:MM)"
                            />
                            <input
                                id="filterBody"
                                placeholder="Body contains"
                            />
                            <input id="filterLocation" placeholder="Location" />
                            <input
                                id="filterCoordinates"
                                placeholder="Coordinates"
                            />
                            <input
                                id="filterExpire"
                                placeholder="Expiring within day"
                            />
                        </div>
                        <div class="filterDropdowns">
                            <p>
                                Location method:
                                <select
                                    id="filterUnchangedLocation"
                                    autocomplete="off"
                                >
                                    <option value="" selected="selected"
                                        >Any</option
                                    >
                                    <option value="device reported"
                                        >Device reported</option
                                    >
                                    <option value="pinned location"
                                        >Pinned location</option
                                    >
                                </select>
                            </p>
                            <p>
                                Status:
                                <select id="filterStatus" autocomplete="off">
                                    <option value="" selected="selected"
                                        >Any</option
                                    >
                                    <option value="New">New</option>
                                    <option value="Incomplete"
                                        >Incomplete</option
                                    >
                                    <option value="Complete">Complete</option>
                                </select>
                            </p>
                            <p>
                                Attachments:
                                <select
                                    id="filterAttachments"
                                    autocomplete="off"
                                >
                                    <option value="" selected="selected"
                                        >Any</option
                                    >
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </p>
                        </div>
                        <div>
                            <button
                                onclick="applyFilters()"
                                id="applyFilters"
                                class="btn navy rounded"
                            >
                                Apply Filters
                            </button>
                            <button
                                onclick="location.reload()"
                                id="resetPage"
                                class="btn navy rounded"
                            >
                                Reset
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row threeQuarters">
                    <div class="column full">
                        <div class="row quarter leaf">
                            <div class="reportHeader">
                                <table>
                                    <tbody>
                                        <tr
                                            onclick="console.log('Row has been clicked')"
                                        >
                                            <td
                                                class="buttonResolvedUnresolved"
                                            >
                                                Status
                                            </td>
                                            <td class="buttonReportIDText">
                                                Report #
                                            </td>
                                            <td class="buttonIncidentIDText">
                                                Inc #
                                            </td>
                                            <td class="buttonReportTSText">
                                                Date & Time
                                            </td>
                                            <td class="buttonTagText">Tag</td>
                                            <td class="buttonLocationText">
                                                Location
                                            </td>
                                            <td class="buttonFullNameText">
                                                Name (Last, First)
                                            </td>
                                            <td class="buttonBodyText">
                                                Description
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="row fiveEighths leaf">
                            <!--Div to be filled by setupListReports()-->
                            <div id="reportList" class="reportList"></div>
                        </div>
                        <div class="row eighth leaf">
                            <center>
                                <div class="navigationButtons">
                                    <button
                                        id="firstBtn"
                                        class="btn navy rounded"
                                        onClick="firstLast('first')"
                                    >
                                        First
                                    </button>
                                    <button
                                        id="prevBtn"
                                        class="btn navy rounded"
                                        onClick="nextPrev(-1)"
                                    >
                                        Prev
                                    </button>
                                    <div id="reportListIndicators"></div>
                                    <!--Div to be filled by setupListReports()-->
                                    <button
                                        id="nextBtn"
                                        class="btn navy rounded"
                                        onClick="nextPrev(1)"
                                    >
                                        Next
                                    </button>
                                    <button
                                        id="lastBtn"
                                        class="btn navy rounded"
                                        onClick="firstLast('last')"
                                    >
                                        Last
                                    </button>
                                </div>
                            </center>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <div id="modalTarget"></div>
        <audio id="incomingTag1" src="./assets/sounds/Ball.wav"></audio>
        <audio id="incomingTag2" src="./assets/sounds/Chime.wav"></audio>
        <audio id="incomingTag3" src="./assets/sounds/Coins.wav"></audio>
        <audio id="incomingTag4" src="./assets/sounds/Crunch.wav"></audio>
        <audio id="incomingTag5" src="./assets/sounds/Maraca.wav"></audio>
        <audio id="incomingTag6" src="./assets/sounds/Shuffle.wav"></audio>
        <audio id="incomingTag0" src="./assets/sounds/Stapler.wav"></audio>
        <script src="./libs/modalLib.js"></script>
        <script src="./libs/navLib.js"></script>
        <script src="./libs/pagination.js"></script>
        <script src="./libs/reportSingle.js"></script>
        <script src="./libs/reportList.js"></script>
        <script src="./libs/reportRefresher.js"></script>
        <script src="./libs/adminCommands.js"></script>
        <script src="./libs/cookieLib.js"></script>

        <!--reportRefresher code-->
        <input type="hidden" id="storedTS" />
        <script>
            // Global Variables
            const pageID = 1; // pageID tells getLatestTS what to do with gotten TS. 0 - homepage, 1 - intake, 2 - reports, 3 - analytics/admin (no impact on current screen)
            /*** Cookie PLACEHOLDERS */

            setCookie("cruzsafe_webID", 1, 1);
            const webID = getCookie("cruzsafe_webID");
            if (webID == "") {
                window.location.href = "./"; // Returns to homepage if no webID cookie is present.
            }

            /*** Cookie PLACEHOLDERS */

            setupModal("modalTarget", createReportModal);

            var tid = "";
            document.addEventListener("DOMContentLoaded", function() {
                // When DOM is loaded
                setupListReports(); // Setup reports initially
                getLatestTS("storedTS", 1); // Gets the initial TS and sets up listener
            });

            // Sets up Timer to call function every 10 seconds;
            // Time is in milliseconds
            if (tid === "") {
                tid = setInterval(checkTS, 5000);
            }

            function checkTS() {
                // Process to test for a different timestamp.
                getLatestTS("storedTS", 0);
            }
            /*** End reportRefresher code ***/
            /*** Filter Code ***/
            /*
                Takes in button ID that initiates the dropdown; this button will have its text replaced by given text.
                This text will be read by report.js upon selecting of apply filters; 
                if it is (Not chosen), nothing is added to dictionary.
            */
            function applySelected(dropbtnID, btn) {
                dropbtn = document.getElementById(dropbtnID);
                dropbtn.innerHTML = btn.innerHTML;
            }
            /*
                Grabs all of the text in filter fields and converts into a dictionary 
                which then sends to reports.js which calls API and modifies the list of reports.
            */
            function applyFilters() {
                // List of all ids of elements to grab text from.
                const filterElements = [
                    "filterTag",
                    "filterIncidentID",
                    "filterDate",
                    "filterTime",
                    "filterStatus",
                    "filterBody",
                    "filterLocation",
                    "filterCoordinates",
                    "filterUnchangedLocation",
                    "filterAttachments",
                    "filterMobileID",
                    "filterFirstName",
                    "filterLastName",
                    "filterEmail",
                    "filterPhone",
                    "filterExpire"
                ];
                var filterDict = {}; // Create the dictionary.
                for (i = 0; i < filterElements.length; i++) {
                    // fill the dictionary
                    element = document.getElementById(filterElements[i]);
                    // With a proper dropdown menu, no longer need to check for the text of the old one
                    // element.value should return the value of any input type elements (text fields + dropboxes qualify)
                    var text = element.value;
                    if (text != "") {
                        // If not empty/not chosen for dropdown
                        filterDict[filterElements[i]] = text; // filterElement:value
                    } else {
                        filterDict[filterElements[i]] = null;
                    }
                }
                // Error checking area! Add more modules in the future.
                // NOte: this one is broken.
                if (
                    Number.isInteger(filterDict["filterIncidentID"] == false) &&
                    filterDict["filterIncidentID"] != null
                ) {
                    alert("Incident ID entry must be a number!");
                } else {
                    filterReports(filterDict); // Else all items are good. Send to filterReports.
                    toggleFilters();
                }
            }
            /*** Filter code end ***/
        </script>
    </body>
</html>
